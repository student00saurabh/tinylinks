<% layout("/layouts/boilerplate") -%>

<div class="mx-auto py-10 px-4 space-y-8 dark:bg-black">

  <!-- Header -->
  <div class="flex flex-col gap-1">
    <h1 class="text-3xl font-semibold text-gray-800 dark:text-gray-100">
      ğŸ‘‹ Welcome, <%= currUser.username %>
    </h1>
    <p class="text-gray-600 dark:text-gray-400 text-sm">
      Manage and track your shortened links with analytics & quick actions.
    </p>
  </div>

  <!-- Add Link Form -->
  <form action="/stats" method="POST"
        class="bg-white dark:bg-gray-900 shadow-md dark:shadow-lg border dark:border-gray-700 rounded-xl p-6 flex flex-col gap-4">

    <div class="grid md:grid-cols-3 gap-3">

      <!-- Long URL -->
      <input 
        required
        type="url"
        name="fullURL"
        placeholder="Enter long URL"
        class="border dark:border-gray-700 p-3 rounded-md bg-white dark:bg-gray-800 
               text-gray-900 dark:text-gray-200 outline-none 
               focus:ring focus:ring-blue-300 dark:focus:ring-blue-600 transition"
      >

      <!-- Custom Short Code -->
      <input
        type="text"
        name="shortId"
        placeholder="Custom short code (optional)"
        class="border dark:border-gray-700 p-3 rounded-md bg-white dark:bg-gray-800 
               text-gray-900 dark:text-gray-200 outline-none 
               focus:ring focus:ring-blue-300 dark:focus:ring-blue-600 transition"
      >

      <!-- Submit -->
      <button
        class="bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 
               text-white py-3 rounded-md font-medium transition flex items-center justify-center gap-2"
      >
        ğŸ”— Shorten Link
      </button>
    </div>

    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
      If custom code is not provided, a random short link will be generated automatically.
    </p>
  </form>

  <!-- Links List -->
  <% if (links.length === 0) { %>
    <div class="text-center mt-16">
      <img src="https://cdn-icons-png.flaticon.com/512/4466/4466623.png" 
           class="w-52 mx-auto opacity-70 mb-4">
      <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-1">No links created yet</h3>
      <p class="text-gray-500 dark:text-gray-400 text-sm">Start shortening your first link above ğŸ‘†</p>
    </div>

  <% } else { %>
    <div class="space-y-4">

      <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">â±ï¸ Your Latest Links</h3>

      <% links.forEach(link => { %>
        <div class="bg-white dark:bg-gray-900 border dark:border-gray-600 rounded-2xl shadow p-4 flex flex-col md:flex-row md:items-center md:justify-between animate-fade">

          <!-- Code & URL -->
          <div class="flex flex-col md:flex-row md:items-center md:space-x-4 flex-1 mb-2 md:mb-0">
            <a href="<%= baseURL %>/stats/<%= link.shortId %>" target="_blank"
               class="font-semibold text-blue-600 dark:text-blue-400 hover:underline md:w-24">
              <%= link.shortId %>
            </a>
            <a href="<%= link.fullURL %>" target="_blank"
               class="text-gray-700 dark:text-gray-200 hover:underline md:flex-1 truncate">
              <%= link.fullURL.length > 40 ? link.fullURL.slice(0, 40) + '...' : link.fullURL %>
            </a>
          </div>

          <!-- Clicks & Last Clicked -->
          <div class="flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-300 mb-2 md:mb-0">
            <span>Clicks: <b><%= link.clicks %></b></span>
            <span>Last: <%= link.createdAt ? link.createdAt.toLocaleString() : "â€”" %></span>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap gap-2 justify-start md:justify-end p-2">
            <a href="/stats/<%= link.shortId %>" target="_blank"
               class="bg-gray-200 dark:bg-gray-400 px-3 py-1 rounded-md 
                      hover:bg-gray-300 dark:hover:bg-gray-600 transition text-sm">
              Stats
            </a>
            <button 
              onclick="navigator.clipboard.writeText('<%= baseURL %>/stats/<%= link.shortId %>'); showToast('Copied!')"
              class="bg-blue-200 dark:bg-blue-400 px-3 py-1 rounded-md 
                     hover:bg-blue-300 dark:hover:bg-blue-600 transition text-sm">
              Copy
            </button>
          </div>

        </div>
      <% }) %>

    </div>
  <% } %>

</div>

<script>
  function showToast(msg) {
    const toast = document.createElement("div");
    toast.innerText = msg;
    toast.className = "fixed bottom-6 right-6 bg-black dark:bg-white text-white dark:text-black px-4 py-2 rounded shadow animate-fade";
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2000);
  }
</script>



